# RunPaceFlow - æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**RunPaceFlow** æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„è·‘æ­¥è®°å½•ä¸åˆ†æå¹³å°ï¼Œç»“åˆäº† [running_page](https://github.com/yihong0618/running_page) çš„æ•°æ®åŒæ­¥èƒ½åŠ›å’Œ [cyc-earth](https://github.com/sun0225SUN/cyc-earth) çš„ç°ä»£åŒ–æ¶æ„ï¼Œæä¾›æ›´ä¸°å¯Œçš„åœ°å›¾äº¤äº’ã€é…é€Ÿåˆ†æå’Œ AI æ™ºèƒ½å»ºè®®åŠŸèƒ½ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸ—ºï¸ **å¢å¼ºåœ°å›¾äº¤äº’**: åŠ¨æ€è·¯çº¿å›æ”¾ã€å®æ—¶é…é€Ÿæ˜¾ç¤ºã€3D åœ°å½¢è§†å›¾
- ğŸ“Š **é…é€Ÿåˆ†æ**: æ¯å…¬é‡Œé…é€Ÿå›¾è¡¨ã€æœ€å¿«é…é€Ÿæ ‡è®°ã€é…é€ŸåŒºé—´åˆ†æ
- ğŸ¤– **AI æ™ºèƒ½å»ºè®®**: åŸºäºè®­ç»ƒæ•°æ®çš„ä¸ªæ€§åŒ–å»ºè®®ã€å—ä¼¤é£é™©é¢„è­¦
- ğŸ¨ **ç°ä»£åŒ– UI**: åŸºäº shadcn/ui çš„ç²¾ç¾ç•Œé¢ã€æ·±è‰²æ¨¡å¼æ”¯æŒ
- ğŸ”„ **å¤šå¹³å°åŒæ­¥**: æ”¯æŒ Garminã€Stravaã€Nike Run Club ç­‰ä¸»æµå¹³å°
- ğŸ“± **å“åº”å¼è®¾è®¡**: å®Œç¾é€‚é…ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯

---

## ğŸ›  æŠ€æœ¯æ ˆ

### å‰ç«¯æ¡†æ¶
- **Next.js 15+** - React å…¨æ ˆæ¡†æ¶ï¼Œæ”¯æŒ App Router
- **React 19** - æœ€æ–°çš„ React ç‰¹æ€§
- **TypeScript** - ç±»å‹å®‰å…¨

### UI å±‚
- **Tailwind CSS 4** - åŸå­åŒ– CSS æ¡†æ¶
- **shadcn/ui** - é«˜è´¨é‡çš„ React ç»„ä»¶åº“
- **Framer Motion** - æµç•…çš„åŠ¨ç”»åº“
- **Lucide Icons** - ç°ä»£åŒ–å›¾æ ‡åº“

### åœ°å›¾å¯è§†åŒ–
- **Mapbox GL JS** - é«˜æ€§èƒ½åœ°å›¾æ¸²æŸ“
- **react-map-gl** - React Mapbox å°è£…
- **deck.gl** - å¤§æ•°æ®å¯è§†åŒ–å±‚ï¼ˆå¯é€‰ï¼‰
- **turf.js** - åœ°ç†ç©ºé—´è®¡ç®—

### æ•°æ®ç®¡ç†
- **tRPC** - ç±»å‹å®‰å…¨çš„ API å±‚
- **TanStack Query** - æ•°æ®è·å–å’Œç¼“å­˜
- **Zustand** - è½»é‡çº§çŠ¶æ€ç®¡ç†
- **Drizzle ORM** - ç±»å‹å®‰å…¨çš„ ORM

### æ•°æ®åº“
- **Turso (libSQL)** - åˆ†å¸ƒå¼ SQLite
- **SQLite** - æœ¬åœ°å¼€å‘æ•°æ®åº“

### AI åŠŸèƒ½
- **OpenAI API** / **Anthropic Claude** - AI å»ºè®®ç”Ÿæˆ
- **LangChain** - AI åº”ç”¨æ¡†æ¶ï¼ˆå¯é€‰ï¼‰
- **Vercel AI SDK** - AI æµå¼å“åº”

### æ•°æ®åŒæ­¥
- **Python 3.11+** - æ•°æ®åŒæ­¥è„šæœ¬
- **Garmin Connect API** - Garmin æ•°æ®
- **Strava API** - Strava æ•°æ®
- **Nike Run Club API** - Nike æ•°æ®

### å¼€å‘å·¥å…·
- **Biome** - ä»£ç æ ¼å¼åŒ–å’Œæ£€æŸ¥
- **Lefthook** - Git hooks ç®¡ç†
- **Drizzle Kit** - æ•°æ®åº“è¿ç§»
- **Bun / pnpm** - åŒ…ç®¡ç†å™¨

### éƒ¨ç½²
- **Vercel** - ä¸»è¦éƒ¨ç½²å¹³å°
- **GitHub Actions** - CI/CD è‡ªåŠ¨åŒ–
- **Umami** - éšç§å‹å¥½çš„åˆ†æå·¥å…·

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
runPaceFlow/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ [locale]/                 # å›½é™…åŒ–è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ (main)/              # ä¸»åº”ç”¨å¸ƒå±€
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx         # é¦–é¡µ - æ€»è§ˆåœ°å›¾
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ activities/      # æ´»åŠ¨åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ activity/[id]/   # å•ä¸ªæ´»åŠ¨è¯¦æƒ…
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ stats/           # ç»Ÿè®¡åˆ†æ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ settings/        # è®¾ç½®é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ api/                      # API Routes
â”‚   â”‚   â”‚   â”œâ”€â”€ trpc/[trpc]/         # tRPC ç«¯ç‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ sync/                # æ•°æ®åŒæ­¥ç«¯ç‚¹
â”‚   â”‚   â”‚   â””â”€â”€ ai/                  # AI å»ºè®®ç«¯ç‚¹
â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                   # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/                      # shadcn/ui ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ map/                     # åœ°å›¾ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ RunMap.tsx           # ä¸»åœ°å›¾ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ RoutePlayer.tsx      # è·¯çº¿å›æ”¾
â”‚   â”‚   â”‚   â”œâ”€â”€ PaceMarker.tsx       # é…é€Ÿæ ‡è®°
â”‚   â”‚   â”‚   â””â”€â”€ MapControls.tsx      # åœ°å›¾æ§åˆ¶
â”‚   â”‚   â”œâ”€â”€ activity/                # æ´»åŠ¨ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ActivityCard.tsx     # æ´»åŠ¨å¡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ PaceChart.tsx        # é…é€Ÿå›¾è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ SplitsTable.tsx      # åˆ†æ®µæ—¶é—´è¡¨
â”‚   â”‚   â”‚   â””â”€â”€ ActivityStats.tsx    # æ´»åŠ¨ç»Ÿè®¡
â”‚   â”‚   â”œâ”€â”€ ai/                      # AI ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ AIInsights.tsx       # AI æ´å¯Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ TrainingAdvice.tsx   # è®­ç»ƒå»ºè®®
â”‚   â”‚   â”‚   â””â”€â”€ InjuryWarning.tsx    # å—ä¼¤é¢„è­¦
â”‚   â”‚   â””â”€â”€ layout/                  # å¸ƒå±€ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ Header.tsx
â”‚   â”‚       â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚       â””â”€â”€ Footer.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                         # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ utils.ts                 # é€šç”¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ pace.ts                  # é…é€Ÿè®¡ç®—
â”‚   â”‚   â”œâ”€â”€ gpx-parser.ts            # GPX è§£æ
â”‚   â”‚   â””â”€â”€ map-utils.ts             # åœ°å›¾å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ server/                      # æœåŠ¡ç«¯ä»£ç 
â”‚   â”‚   â”œâ”€â”€ db/                      # æ•°æ®åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.ts            # æ•°æ®åº“æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ migrations/          # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ api/                     # API é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ routers/             # tRPC è·¯ç”±
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ activity.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ stats.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ai.ts
â”‚   â”‚   â”‚   â””â”€â”€ root.ts
â”‚   â”‚   â””â”€â”€ services/                # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚       â”œâ”€â”€ activity-service.ts
â”‚   â”‚       â”œâ”€â”€ sync-service.ts
â”‚   â”‚       â””â”€â”€ ai-service.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/                      # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ map-store.ts            # åœ°å›¾çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ activity-store.ts       # æ´»åŠ¨çŠ¶æ€
â”‚   â”‚   â””â”€â”€ ui-store.ts             # UI çŠ¶æ€
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                       # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ activity.ts
â”‚   â”‚   â”œâ”€â”€ map.ts
â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                       # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ use-activities.ts
â”‚   â”‚   â”œâ”€â”€ use-map.ts
â”‚   â”‚   â””â”€â”€ use-pace-analysis.ts
â”‚   â”‚
â”‚   â””â”€â”€ styles/                      # æ ·å¼æ–‡ä»¶
â”‚       â””â”€â”€ globals.css
â”‚
â”œâ”€â”€ scripts/                         # Python åŒæ­¥è„šæœ¬
â”‚   â”œâ”€â”€ sync/
â”‚   â”‚   â”œâ”€â”€ garmin_sync.py
â”‚   â”‚   â”œâ”€â”€ strava_sync.py
â”‚   â”‚   â””â”€â”€ nike_sync.py
â”‚   â”œâ”€â”€ parsers/
â”‚   â”‚   â”œâ”€â”€ gpx_parser.py
â”‚   â”‚   â”œâ”€â”€ tcx_parser.py
â”‚   â”‚   â””â”€â”€ fit_parser.py
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ pace_calculator.py
â”‚       â””â”€â”€ db_utils.py
â”‚
â”œâ”€â”€ public/                          # é™æ€èµ„æº
â”‚   â”œâ”€â”€ icons/
â”‚   â””â”€â”€ images/
â”‚
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ sync-data.yml           # è‡ªåŠ¨åŒæ­¥æ•°æ®
â”‚       â””â”€â”€ deploy.yml              # éƒ¨ç½²æµç¨‹
â”‚
â”œâ”€â”€ drizzle/                        # æ•°æ®åº“ç›¸å…³
â”‚   â””â”€â”€ migrations/
â”‚
â”œâ”€â”€ messages/                        # å›½é™…åŒ–æ–‡ä»¶
â”‚   â”œâ”€â”€ en.json
â”‚   â””â”€â”€ zh.json
â”‚
â”œâ”€â”€ .env.example                    # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .env.local                      # æœ¬åœ°ç¯å¢ƒå˜é‡
â”œâ”€â”€ next.config.js                  # Next.js é…ç½®
â”œâ”€â”€ tailwind.config.ts              # Tailwind é…ç½®
â”œâ”€â”€ tsconfig.json                   # TypeScript é…ç½®
â”œâ”€â”€ drizzle.config.ts              # Drizzle é…ç½®
â””â”€â”€ package.json
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

```typescript
// activities è¡¨ - æ´»åŠ¨è®°å½•
{
  id: string (uuid)
  user_id: string
  title: string
  description: text?
  type: enum ('running', 'cycling', 'walking')
  start_time: timestamp
  end_time: timestamp
  duration: integer (ç§’)
  distance: float (ç±³)
  elevation_gain: float (ç±³)
  average_pace: float (ç§’/å…¬é‡Œ)
  best_pace: float (ç§’/å…¬é‡Œ)
  average_heart_rate: integer?
  max_heart_rate: integer?
  calories: integer?
  source: enum ('garmin', 'strava', 'nike', 'manual')
  source_id: string?
  gpx_data: text (JSON)
  splits: text (JSON)
  created_at: timestamp
  updated_at: timestamp
}

// splits è¡¨ - åˆ†æ®µæ•°æ®
{
  id: string (uuid)
  activity_id: string (FK)
  split_number: integer
  distance: float (ç±³)
  duration: integer (ç§’)
  pace: float (ç§’/å…¬é‡Œ)
  elevation_gain: float (ç±³)
  heart_rate_avg: integer?
  created_at: timestamp
}

// pace_zones è¡¨ - é…é€ŸåŒºé—´
{
  id: string (uuid)
  activity_id: string (FK)
  zone_name: string ('Z1', 'Z2', 'Z3', 'Z4', 'Z5')
  min_pace: float
  max_pace: float
  duration: integer (ç§’)
  distance: float (ç±³)
  percentage: float
  created_at: timestamp
}

// ai_insights è¡¨ - AI å»ºè®®
{
  id: string (uuid)
  user_id: string
  activity_id: string? (FK)
  insight_type: enum ('training', 'injury_warning', 'goal', 'recovery')
  content: text
  metadata: text (JSON)
  created_at: timestamp
  read_at: timestamp?
}

// user_stats è¡¨ - ç”¨æˆ·ç»Ÿè®¡
{
  id: string (uuid)
  user_id: string
  total_activities: integer
  total_distance: float (ç±³)
  total_duration: integer (ç§’)
  total_elevation: float (ç±³)
  best_pace: float (ç§’/å…¬é‡Œ)
  longest_run: float (ç±³)
  current_week_distance: float
  current_month_distance: float
  updated_at: timestamp
}
```

---

## ğŸ¨ æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

### 1. åœ°å›¾äº¤äº’ä¸åŠ¨ç”»

#### è·¯çº¿å›æ”¾åŠŸèƒ½
```typescript
// RoutePlayer.tsx
- æ’­æ”¾/æš‚åœæ§åˆ¶
- é€Ÿåº¦è°ƒèŠ‚ï¼ˆ0.5x, 1x, 2x, 5xï¼‰
- è¿›åº¦æ¡æ‹–æ‹½
- å®æ—¶æ˜¾ç¤ºå½“å‰ä½ç½®çš„é…é€Ÿã€å¿ƒç‡ã€æµ·æ‹”
- é…é€Ÿé¢œè‰²æ˜ å°„ï¼ˆå¿«é€Ÿ=ç»¿è‰²ï¼Œæ…¢é€Ÿ=çº¢è‰²ï¼‰
- å¹³æ»‘çš„ç›¸æœºè·Ÿéš
```

#### é…é€Ÿå¯è§†åŒ–
```typescript
// é…é€Ÿçƒ­åŠ›å›¾
- ä½¿ç”¨æ¸å˜è‰²è¡¨ç¤ºä¸åŒé…é€ŸåŒºé—´
- ç»¿è‰²: å¿«é€Ÿï¼ˆ< å¹³å‡é…é€Ÿ - 30ç§’ï¼‰
- é»„è‰²: æ­£å¸¸ï¼ˆå¹³å‡é…é€Ÿ Â± 30ç§’ï¼‰
- æ©™è‰²: æ…¢é€Ÿï¼ˆ> å¹³å‡é…é€Ÿ + 30ç§’ï¼‰
- çº¢è‰²: å¾ˆæ…¢ï¼ˆ> å¹³å‡é…é€Ÿ + 60ç§’ï¼‰

// æ¯å…¬é‡Œæ ‡è®°
- åœ¨è·¯çº¿ä¸Šæ¯å…¬é‡Œæ·»åŠ æ ‡è®°ç‚¹
- ç‚¹å‡»æ ‡è®°æ˜¾ç¤ºè¯¥å…¬é‡Œçš„è¯¦ç»†æ•°æ®
- æ ‡è®°é¢œè‰²æ ¹æ®é…é€Ÿå˜åŒ–
```

#### 3D åœ°å½¢è§†å›¾
```typescript
// å¯é€‰åŠŸèƒ½
- åˆ‡æ¢ 2D/3D è§†å›¾
- æ˜¾ç¤ºæµ·æ‹”å˜åŒ–
- å¡åº¦å¯è§†åŒ–
```

### 2. é…é€Ÿåˆ†æç³»ç»Ÿ

#### é…é€Ÿå›¾è¡¨
```typescript
// PaceChart.tsx
interface PaceChartData {
  kilometer: number;
  pace: number; // ç§’/å…¬é‡Œ
  heartRate?: number;
  elevation?: number;
}

// åŠŸèƒ½:
- æ¯å…¬é‡Œé…é€ŸæŠ˜çº¿å›¾
- å¹³å‡é…é€Ÿå‚è€ƒçº¿
- æœ€å¿«é…é€Ÿæ ‡è®°
- é…é€ŸåŒºé—´å¡«å……
- å¯ç¼©æ”¾ã€å¯æ‹–æ‹½
- æ‚¬åœæ˜¾ç¤ºè¯¦ç»†æ•°æ®
```

#### é…é€Ÿç»Ÿè®¡
```typescript
// å…³é”®æŒ‡æ ‡
- å¹³å‡é…é€Ÿ
- æœ€å¿«é…é€Ÿï¼ˆ1kmã€5kmã€10km PRï¼‰
- é…é€Ÿæ ‡å‡†å·®ï¼ˆä¸€è‡´æ€§æŒ‡æ ‡ï¼‰
- é…é€ŸåŒºé—´åˆ†å¸ƒ
- è´Ÿåˆ†æ®µæ£€æµ‹ï¼ˆååŠç¨‹åŠ é€Ÿï¼‰
- é…é€Ÿä¸‹é™ç‡
```

#### åˆ†æ®µæ•°æ®è¡¨
```typescript
// SplitsTable.tsx
æ¯å…¬é‡Œæ˜¾ç¤º:
- å…¬é‡Œæ•°
- ç”¨æ—¶
- é…é€Ÿ
- ä¸å¹³å‡é…é€Ÿå·®å¼‚
- é…é€Ÿè¶‹åŠ¿ï¼ˆâ†‘â†“ï¼‰
- æµ·æ‹”å˜åŒ–
- å¹³å‡å¿ƒç‡
```

### 3. AI æ™ºèƒ½å»ºè®®ç³»ç»Ÿ

#### è®­ç»ƒå»ºè®®
```typescript
// AI åˆ†æå†…å®¹
- è®­ç»ƒè´Ÿè·è¯„ä¼°ï¼ˆæ˜¯å¦è¿‡åº¦è®­ç»ƒï¼‰
- é…é€Ÿä¸€è‡´æ€§åˆ†æ
- å»ºè®®çš„é…é€ŸåŒºé—´
- ä¸‹æ¬¡è®­ç»ƒè®¡åˆ’
- é•¿æœŸç›®æ ‡å»ºè®®

// è¾“å…¥æ•°æ®
- æœ€è¿‘ 30 å¤©çš„æ´»åŠ¨è®°å½•
- é…é€Ÿå˜åŒ–è¶‹åŠ¿
- è®­ç»ƒé¢‘ç‡
- æ¢å¤æ—¶é—´
```

#### å—ä¼¤é£é™©é¢„è­¦
```typescript
// é¢„è­¦æŒ‡æ ‡
- è®­ç»ƒé‡çªç„¶å¢åŠ ï¼ˆ>10% æ¯å‘¨ï¼‰
- è¿ç»­å¤šå¤©é«˜å¼ºåº¦è®­ç»ƒ
- é…é€Ÿä¸‹é™è¶‹åŠ¿
- æ¢å¤æ—¶é—´ä¸è¶³

// AI å»ºè®®
- ä¼‘æ¯å»ºè®®
- é™ä½å¼ºåº¦å»ºè®®
- äº¤å‰è®­ç»ƒå»ºè®®
```

#### ç›®æ ‡è¾¾æˆåˆ†æ
```typescript
// ç›®æ ‡ç±»å‹
- å®Œæˆé©¬æ‹‰æ¾/åŠé©¬
- æå‡é…é€Ÿ
- å¢åŠ è·‘é‡
- å‡é‡ç›®æ ‡

// AI åé¦ˆ
- å½“å‰è¿›åº¦
- é¢„æµ‹å®Œæˆæ—¶é—´
- è®­ç»ƒè®¡åˆ’è°ƒæ•´
```

### 4. æ•°æ®åŒæ­¥ç³»ç»Ÿ

#### æ”¯æŒçš„å¹³å°
```typescript
// Garmin Connect
- è‡ªåŠ¨åŒæ­¥æ´»åŠ¨
- æ”¯æŒ GPX/TCX/FIT æ ¼å¼
- è·å–è¯¦ç»†çš„ä¼ æ„Ÿå™¨æ•°æ®

// Strava
- OAuth æˆæƒ
- æ´»åŠ¨è‡ªåŠ¨å¯¼å…¥
- æ”¯æŒ Kudos åŒæ­¥

// Nike Run Club
- Token è®¤è¯
- æ´»åŠ¨åˆ—è¡¨è·å–
- GPX æ•°æ®å¯¼å‡º

// æ‰‹åŠ¨ä¸Šä¼ 
- æ‹–æ‹½ä¸Šä¼  GPX/TCX/FIT æ–‡ä»¶
- è‡ªåŠ¨è§£æå’Œå­˜å‚¨
```

#### åŒæ­¥ç­–ç•¥
```typescript
// GitHub Actions å®šæ—¶ä»»åŠ¡
- æ¯å°æ—¶æ£€æŸ¥æ–°æ´»åŠ¨
- å¢é‡åŒæ­¥æœºåˆ¶
- å¤±è´¥é‡è¯•é€»è¾‘
- æ•°æ®ä¸€è‡´æ€§æ ¡éªŒ

// æ‰‹åŠ¨è§¦å‘åŒæ­¥
- ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»åŒæ­¥æŒ‰é’®
- WebSocket å®æ—¶è¿›åº¦æ˜¾ç¤º
```

---

## ğŸ¨ UI/UX è®¾è®¡åŸåˆ™

### è®¾è®¡é£æ ¼
- **ç®€æ´ç°ä»£**: é‡‡ç”¨å¡ç‰‡å¼å¸ƒå±€ï¼Œç•™ç™½å……è¶³
- **æ•°æ®é©±åŠ¨**: é‡ç‚¹çªå‡ºå…³é”®æ•°æ®ï¼Œæ¬¡è¦ä¿¡æ¯å¼±åŒ–
- **è‰²å½©ç³»ç»Ÿ**:
  - ä¸»è‰²: è“è‰²ç³»ï¼ˆè¿åŠ¨æ„Ÿï¼‰
  - è¾…åŠ©è‰²: ç»¿è‰²ï¼ˆå¥½ï¼‰ã€æ©™è‰²ï¼ˆè­¦å‘Šï¼‰ã€çº¢è‰²ï¼ˆå±é™©ï¼‰
  - æ·±è‰²æ¨¡å¼: OLED å‹å¥½çš„çº¯é»‘èƒŒæ™¯

### å…³é”®é¡µé¢è®¾è®¡

#### é¦–é¡µ - æ€»è§ˆåœ°å›¾
```
- é¡¶éƒ¨: ç»Ÿè®¡å¡ç‰‡ï¼ˆæ€»é‡Œç¨‹ã€æœ¬å‘¨è·‘é‡ã€æœ¬æœˆè·‘é‡ï¼‰
- ä¸­é—´: å¤§åœ°å›¾æ˜¾ç¤ºæ‰€æœ‰è·‘æ­¥è·¯çº¿
- åº•éƒ¨: æœ€è¿‘æ´»åŠ¨åˆ—è¡¨
- å³ä¾§: å¿«æ·æ“ä½œï¼ˆåŒæ­¥ã€ä¸Šä¼ ã€è®¾ç½®ï¼‰
```

#### æ´»åŠ¨è¯¦æƒ…é¡µ
```
- é¡¶éƒ¨: æ´»åŠ¨æ ‡é¢˜ã€æ—¶é—´ã€å…³é”®æ•°æ®
- åœ°å›¾åŒºåŸŸ: å¸¦å›æ”¾åŠŸèƒ½çš„è·¯çº¿å›¾
- é…é€Ÿåˆ†æåŒº: é…é€Ÿå›¾è¡¨ã€åˆ†æ®µè¡¨
- AI å»ºè®®åŒº: æ™ºèƒ½æ´å¯Ÿå¡ç‰‡
- åº•éƒ¨: ç›¸ä¼¼æ´»åŠ¨æ¨è
```

#### ç»Ÿè®¡åˆ†æé¡µ
```
- æ—¶é—´ç­›é€‰å™¨ï¼ˆå‘¨/æœˆ/å¹´/å…¨éƒ¨ï¼‰
- è¶‹åŠ¿å›¾è¡¨ï¼ˆè·ç¦»ã€é…é€Ÿã€å¿ƒç‡ï¼‰
- ä¸ªäººè®°å½•ï¼ˆPR åˆ—è¡¨ï¼‰
- æœˆåº¦ç»Ÿè®¡æ—¥å†
- é…é€ŸåŒºé—´åˆ†å¸ƒå›¾
```

### å“åº”å¼è®¾è®¡
```
Desktop (â‰¥1024px):
- ä¾§è¾¹æ å¯¼èˆª
- å¤šåˆ—å¸ƒå±€
- å¤§åœ°å›¾è§†å›¾

Tablet (768px - 1023px):
- é¡¶éƒ¨å¯¼èˆªæ 
- ä¸¤åˆ—å¸ƒå±€
- ä¸­ç­‰åœ°å›¾è§†å›¾

Mobile (< 768px):
- åº•éƒ¨æ ‡ç­¾æ 
- å•åˆ—å¸ƒå±€
- ç´§å‡‘åœ°å›¾è§†å›¾
- æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š
```

---

## ğŸ”Œ API è®¾è®¡

### tRPC Router ç»“æ„

```typescript
// activity router
trpc.activity.list                  // è·å–æ´»åŠ¨åˆ—è¡¨
trpc.activity.getById               // è·å–å•ä¸ªæ´»åŠ¨
trpc.activity.create                // åˆ›å»ºæ´»åŠ¨
trpc.activity.update                // æ›´æ–°æ´»åŠ¨
trpc.activity.delete                // åˆ é™¤æ´»åŠ¨
trpc.activity.getSplits             // è·å–åˆ†æ®µæ•°æ®
trpc.activity.getPaceAnalysis       // è·å–é…é€Ÿåˆ†æ

// stats router
trpc.stats.summary                  // æ€»è§ˆç»Ÿè®¡
trpc.stats.byPeriod                 // æŒ‰æ—¶é—´æ®µç»Ÿè®¡
trpc.stats.personalRecords          // ä¸ªäººè®°å½•
trpc.stats.trends                   // è¶‹åŠ¿æ•°æ®

// ai router
trpc.ai.getInsights                 // è·å– AI æ´å¯Ÿ
trpc.ai.generateAdvice              // ç”Ÿæˆè®­ç»ƒå»ºè®®
trpc.ai.checkInjuryRisk             // æ£€æŸ¥å—ä¼¤é£é™©
trpc.ai.suggestGoal                 // å»ºè®®ç›®æ ‡

// sync router
trpc.sync.triggerSync               // è§¦å‘åŒæ­¥
trpc.sync.getStatus                 // è·å–åŒæ­¥çŠ¶æ€
trpc.sync.uploadFile                // ä¸Šä¼ æ–‡ä»¶
```

### REST API (ç”¨äº Webhook)
```
POST /api/webhook/garmin            // Garmin webhook
POST /api/webhook/strava            // Strava webhook
POST /api/sync/manual               // æ‰‹åŠ¨åŒæ­¥
GET  /api/health                    // å¥åº·æ£€æŸ¥
```

---

## ğŸš€ å¼€å‘è·¯çº¿å›¾

### Phase 1 - MVP (4-6 å‘¨)
**ç›®æ ‡**: åŸºæœ¬çš„æ´»åŠ¨å±•ç¤ºå’Œæ•°æ®åŒæ­¥

- [ ] æ­å»º Next.js é¡¹ç›®æ¡†æ¶
- [ ] è®¾è®¡å¹¶å®ç°æ•°æ®åº“ schema
- [ ] å®ç°åŸºç¡€çš„åœ°å›¾å±•ç¤º
- [ ] å®ç°æ´»åŠ¨åˆ—è¡¨å’Œè¯¦æƒ…é¡µ
- [ ] å®ç° Strava æ•°æ®åŒæ­¥
- [ ] åŸºç¡€çš„é…é€Ÿå›¾è¡¨å±•ç¤º
- [ ] å“åº”å¼å¸ƒå±€

### Phase 2 - å¢å¼ºåŠŸèƒ½ (4-6 å‘¨)
**ç›®æ ‡**: æ ¸å¿ƒåœ°å›¾äº¤äº’å’Œé…é€Ÿåˆ†æ

- [ ] è·¯çº¿å›æ”¾åŠ¨ç”»
- [ ] é…é€Ÿçƒ­åŠ›å›¾
- [ ] æ¯å…¬é‡Œæ ‡è®°ç‚¹
- [ ] å®Œæ•´çš„é…é€Ÿåˆ†æç³»ç»Ÿ
- [ ] åˆ†æ®µæ•°æ®è¡¨
- [ ] ç»Ÿè®¡åˆ†æé¡µé¢
- [ ] Garmin æ•°æ®åŒæ­¥
- [ ] Nike Run Club åŒæ­¥

### Phase 3 - AI åŠŸèƒ½ (3-4 å‘¨)
**ç›®æ ‡**: AI æ™ºèƒ½å»ºè®®

- [ ] é›†æˆ OpenAI/Claude API
- [ ] è®­ç»ƒå»ºè®®ç”Ÿæˆ
- [ ] å—ä¼¤é£é™©é¢„è­¦
- [ ] ç›®æ ‡è¾¾æˆåˆ†æ
- [ ] AI å¯¹è¯ç•Œé¢ï¼ˆå¯é€‰ï¼‰

### Phase 4 - ä¼˜åŒ–ä¸æ‰©å±• (æŒç»­)
**ç›®æ ‡**: ç”¨æˆ·ä½“éªŒä¼˜åŒ–

- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆå¤§é‡æ•°æ®ï¼‰
- [ ] 3D åœ°å½¢è§†å›¾
- [ ] ç¤¾äº¤åŠŸèƒ½ï¼ˆå…³æ³¨ã€ç‚¹èµï¼‰
- [ ] æ´»åŠ¨åˆ†äº«åŠŸèƒ½
- [ ] ç§»åŠ¨ç«¯ PWA
- [ ] æ•°æ®å¯¼å‡ºåŠŸèƒ½
- [ ] æ›´å¤šè¿åŠ¨ç±»å‹æ”¯æŒ

---

## ğŸ” ç¯å¢ƒå˜é‡é…ç½®

```bash
# .env.example

# Database
DATABASE_PROVIDER="turso"           # sqlite | turso
DATABASE_URL="file:./db.sqlite"
TURSO_DATABASE_URL=""
TURSO_DATABASE_TOKEN=""

# Mapbox
NEXT_PUBLIC_MAPBOX_ACCESS_TOKEN=""

# AI Services
OPENAI_API_KEY=""                   # æˆ– ANTHROPIC_API_KEY
AI_MODEL="gpt-4o-mini"              # æˆ– claude-3-5-sonnet

# Strava
STRAVA_CLIENT_ID=""
STRAVA_CLIENT_SECRET=""
STRAVA_REFRESH_TOKEN=""

# Garmin
GARMIN_EMAIL=""
GARMIN_PASSWORD=""
GARMIN_IS_CN="false"                # ä¸­å›½åŒºè®¾ä¸º true

# Nike Run Club
NIKE_ACCESS_TOKEN=""

# Analytics
NEXT_PUBLIC_UMAMI_ANALYTICS_ID=""
NEXT_PUBLIC_UMAMI_ANALYTICS_JS=""

# App Config
NEXT_PUBLIC_APP_URL="http://localhost:3000"
NEXT_PUBLIC_DEFAULT_LOCALE="en"
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### å‰ç«¯ä¼˜åŒ–
- **ä»£ç åˆ†å‰²**: è·¯ç”±çº§åˆ«çš„åŠ¨æ€å¯¼å…¥
- **å›¾ç‰‡ä¼˜åŒ–**: Next.js Image ç»„ä»¶ï¼ŒWebP æ ¼å¼
- **æ•°æ®é¢„å–**: TanStack Query é¢„å–æœºåˆ¶
- **è™šæ‹Ÿæ»šåŠ¨**: å¤§é‡æ´»åŠ¨åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
- **æ‡’åŠ è½½**: åœ°å›¾å’Œå›¾è¡¨ç»„ä»¶æ‡’åŠ è½½

### åœ°å›¾ä¼˜åŒ–
- **ç“¦ç‰‡ç¼“å­˜**: Mapbox ç“¦ç‰‡ç¼“å­˜ç­–ç•¥
- **è·¯çº¿ç®€åŒ–**: ç®€åŒ– GPX åæ ‡ç‚¹ï¼ˆDouglas-Peucker ç®—æ³•ï¼‰
- **èšåˆæ˜¾ç¤º**: å¤§é‡æ´»åŠ¨æ—¶ä½¿ç”¨èšåˆæ˜¾ç¤º
- **WebGL æ¸²æŸ“**: å……åˆ†åˆ©ç”¨ GPU åŠ é€Ÿ

### æ•°æ®åº“ä¼˜åŒ–
- **ç´¢å¼•**: åœ¨å¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
- **åˆ†é¡µ**: æ´»åŠ¨åˆ—è¡¨ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µ
- **ç¼“å­˜**: ç»Ÿè®¡æ•°æ®ä½¿ç”¨ Redis ç¼“å­˜ï¼ˆå¯é€‰ï¼‰
- **æ‰¹é‡æ“ä½œ**: æ•°æ®åŒæ­¥ä½¿ç”¨æ‰¹é‡æ’å…¥

### AI è¯·æ±‚ä¼˜åŒ–
- **æµå¼å“åº”**: ä½¿ç”¨ AI SDK çš„æµå¼è¾“å‡º
- **ç¼“å­˜å»ºè®®**: ç›¸ä¼¼è®­ç»ƒæ•°æ®ç¼“å­˜ AI å»ºè®®
- **åå°ä»»åŠ¡**: AI åˆ†ææ”¾å…¥åå°é˜Ÿåˆ—
- **æˆæœ¬æ§åˆ¶**: ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹ï¼ˆGPT-4o-miniï¼‰

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- é…é€Ÿè®¡ç®—é€»è¾‘
- GPX è§£æå™¨
- æ•°æ®è½¬æ¢å‡½æ•°

### é›†æˆæµ‹è¯•
- API ç«¯ç‚¹æµ‹è¯•
- æ•°æ®åº“æ“ä½œæµ‹è¯•
- æ•°æ®åŒæ­¥æµç¨‹æµ‹è¯•

### E2E æµ‹è¯•
- å…³é”®ç”¨æˆ·æµç¨‹
- åœ°å›¾äº¤äº’æµ‹è¯•
- æ•°æ®ä¸Šä¼ æµç¨‹

### æµ‹è¯•å·¥å…·
- **Vitest** - å•å…ƒæµ‹è¯•
- **Playwright** - E2E æµ‹è¯•
- **React Testing Library** - ç»„ä»¶æµ‹è¯•

---

## ğŸ“¦ éƒ¨ç½²æ–¹æ¡ˆ

### Vercel éƒ¨ç½² (æ¨è)
```bash
1. è¿æ¥ GitHub ä»“åº“
2. é…ç½®ç¯å¢ƒå˜é‡
3. è‡ªåŠ¨éƒ¨ç½²
```

### è‡ªæ‰˜ç®¡éƒ¨ç½²
```bash
# ä½¿ç”¨ Docker
docker build -t runpaceflow .
docker run -p 3000:3000 runpaceflow

# æˆ–ä½¿ç”¨ PM2
pnpm build
pm2 start npm --name "runpaceflow" -- start
```

### CI/CD æµç¨‹
```yaml
# .github/workflows/deploy.yml
- ä»£ç æ£€æŸ¥ï¼ˆBiomeï¼‰
- ç±»å‹æ£€æŸ¥ï¼ˆTypeScriptï¼‰
- è¿è¡Œæµ‹è¯•
- æ„å»ºé¡¹ç›®
- éƒ¨ç½²åˆ° Vercel
```

---

## ğŸ”’ å®‰å…¨è€ƒè™‘

### æ•°æ®å®‰å…¨
- æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
- API Token å®šæœŸè½®æ¢
- ç”¨æˆ·æ•°æ®éš”ç¦»

### API å®‰å…¨
- Rate limiting
- CORS é…ç½®
- CSRF ä¿æŠ¤
- SQL æ³¨å…¥é˜²æŠ¤ï¼ˆDrizzle ORMï¼‰

### éšç§ä¿æŠ¤
- å¯é€‰çš„è·¯çº¿æ¨¡ç³ŠåŒ–
- èµ·ç‚¹/ç»ˆç‚¹éšè—é€‰é¡¹
- æ•°æ®å¯¼å‡ºå’Œåˆ é™¤åŠŸèƒ½
- GDPR åˆè§„

---

## ğŸ“š å‚è€ƒèµ„æº

### æŠ€æœ¯æ–‡æ¡£
- [Next.js Documentation](https://nextjs.org/docs)
- [Mapbox GL JS API](https://docs.mapbox.com/mapbox-gl-js/api/)
- [tRPC Documentation](https://trpc.io/docs)
- [Drizzle ORM](https://orm.drizzle.team/docs/overview)

### çµæ„Ÿæ¥æº
- [running_page](https://github.com/yihong0618/running_page)
- [cyc-earth](https://github.com/sun0225SUN/cyc-earth)
- [Strava](https://www.strava.com)
- [Garmin Connect](https://connect.garmin.com)

---

## ğŸ“ å¾…ç¡®è®¤äº‹é¡¹

### æŠ€æœ¯é€‰å‹
- [ ] AI æœåŠ¡é€‰æ‹©: OpenAI vs Claude vs æœ¬åœ°æ¨¡å‹
- [ ] æ•°æ®åº“: Turso vs PostgreSQL vs SQLite
- [ ] è®¤è¯æ–¹æ¡ˆ: NextAuth.js vs Clerk vs è‡ªç ”

### åŠŸèƒ½ä¼˜å…ˆçº§
- [ ] ç¤¾äº¤åŠŸèƒ½æ˜¯å¦çº³å…¥ MVP
- [ ] æ˜¯å¦æ”¯æŒå¤šç”¨æˆ·
- [ ] æ˜¯å¦éœ€è¦ç§»åŠ¨ç«¯ App

### è®¾è®¡ç»†èŠ‚
- [ ] ä¸»é¢˜è‰²ç¡®è®¤
- [ ] Logo è®¾è®¡
- [ ] å“ç‰Œå‘½åæœ€ç»ˆç¡®è®¤

---

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### æŠ€æœ¯æŒ‡æ ‡
- é¦–å±åŠ è½½æ—¶é—´ < 2s
- Lighthouse æ€§èƒ½åˆ†æ•° > 90
- åœ°å›¾å¸§ç‡ > 30fps
- API å“åº”æ—¶é—´ < 200ms

### ç”¨æˆ·æŒ‡æ ‡
- æ´»åŠ¨ä¸Šä¼ æˆåŠŸç‡ > 99%
- æ•°æ®åŒæ­¥å‡†ç¡®ç‡ > 99.9%
- ç”¨æˆ·ç•™å­˜ç‡ (Week 1) > 60%
- AI å»ºè®®æœ‰ç”¨æ€§è¯„åˆ† > 4/5

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¼€å‘æµç¨‹
1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤å˜æ›´
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

### ä»£ç è§„èŒƒ
- ä½¿ç”¨ Biome æ ¼å¼åŒ–ä»£ç 
- TypeScript strict æ¨¡å¼
- ç»„ä»¶ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶
- ä¼˜å…ˆä½¿ç”¨ Server Components

### æäº¤è§„èŒƒ
- feat: æ–°åŠŸèƒ½
- fix: ä¿®å¤
- docs: æ–‡æ¡£
- style: æ ¼å¼
- refactor: é‡æ„
- test: æµ‹è¯•
- chore: æ„å»ºå·¥å…·

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-01-04
**ç»´æŠ¤è€…**: RunPaceFlow Team
